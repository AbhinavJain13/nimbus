<?xml version="1.0" encoding="UTF-8"?>

<!--
     Discover conf files.  The conf files hold name/value pairs that are
     brought into the XML files in this directory via Spring's nice properties
     mechanism.

     Concentrate all uses of PropertyPlaceholderConfigurer into this bean
     config so that the install script can do token replacements for absolute
     paths throughout the entire spring configuration by just running the
     token replacement on this file.

     Spring wants "//" in front of absolute filesystem paths so that is why
     "/TOKEN" is used here instead of "TOKEN"
-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

    <bean id="EC2ClientSettings"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">

        <property name="location" value="/@EC2CLIENT_CONFDIR@/ec2client.conf" />
        <property name="placeholderPrefix" value="$EC2CLIENT{" />
    </bean>

    <bean id="otherEC2ClientSettings"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">

        <property name="location" value="/@EC2CLIENT_CONFDIR@/other/other-ec2client.conf" />
        <property name="placeholderPrefix" value="$OTHER_EC2CLIENT{" />
    </bean>

    <bean id="otherGatewaySettings"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">

        <property name="location" value="/@GATEWAY_CONFDIR@/other/other-gateway.conf" />
        <property name="placeholderPrefix" value="$OTHER_GATEWAY{" />
    </bean>

    <bean id="commonSettings"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">

        <property name="location"
                  value="/@EC2CLIENT_CONFDIR@/other/common.conf" />
        <property name="placeholderPrefix"
                  value="$COMMON{" />
    </bean>

    <!-- Hibernate Session Factory config is also here, to take advantage of token replacement -->

    <bean id="hibernateSessionFactory"
          class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">

        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.DerbyDialect</prop>
                <prop key="hibernate.connection.url">jdbc:derby:@GATEWAY_PERSISTENCEDIR@/EC2AccountingDB;create=false</prop>
                <prop key="hibernate.connection.driver_class">org.apache.derby.jdbc.EmbeddedDriver</prop>
                <prop key="hibernate.current_session_context_class">thread</prop>
            </props>
        </property>

        <property name="annotatedClasses">
            <list>
                <value>org.nimbustools.gateway.accounting.manager.defaults.DefaultAccount</value>
                <value>org.nimbustools.gateway.accounting.manager.defaults.DefaultInstance</value>
                <value>org.nimbustools.gateway.ec2.monitoring.defaults.DefaultEC2Instance</value>
            </list>
        </property>

    </bean>

    
</beans>