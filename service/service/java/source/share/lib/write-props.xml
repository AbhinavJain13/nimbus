<?xml version="1.0"?>

<project default="writeprops" basedir="." name="rewrite database props">

    <!-- ***********************************************************************
         PROPS
         ******************************************************************* -->

    <property environment="env" />
    <property name="env.GLOBUS_LOCATION" value="."/>
    <property name="deploy.dir" location="${env.GLOBUS_LOCATION}"/>

    <property name="base.package.name"
              value="nimbus" />

    <property name="base.conf.dir"
              value="${deploy.dir}/etc/${base.package.name}" />

    <property name="workspace.conf.dir"
              value="${base.conf.dir}/workspace-service" />

    <property name="workspace.persistence.dir"
              value="${deploy.dir}/var/${base.package.name}" />

    <property name="dbsetup.dir"
              location="${deploy.dir}/share/${base.package.name}"/>


    <!-- ***********************************************************************
         SETUP FOR CALLING db-mgmt.xml
         ******************************************************************* -->

    <!-- Write a properties file so that subsequent standalone invocations
         of db-mgmt.xml will work -->
    <target name="writeprops">
        <propertyfile file="${dbsetup.dir}/workspace.persistence.conf"
                      comment="Autogenerated by post-deploy">

            <entry key="workspace.dbdir.prop"
                   value="${workspace.persistence.dir}" />
            <entry key="workspace.sqldir.prop"
                   value="${dbsetup.dir}/lib" />
            <entry key="workspace.notifdir.prop"
                   value="${dbsetup.dir}/lib" />
            <entry key="derby.system.home.prop"
                   value="${deploy.dir}/var" />
            <entry key="derby.relative.dir.prop"
                   value="${base.package.name}" />
            <entry key="derby.classpath.dir.prop"
                   value="${deploy.dir}/lib" />
            <entry key="pwGen.path.prop"
                   value="${workspace.conf.dir}/other/shared-secret-suggestion.py"/>

        </propertyfile>
    </target>

</project>
